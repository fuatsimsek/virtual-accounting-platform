{% extends "base.html" %}
{% block title %}Kullanıcı Yönetimi{% endblock %}
{% block content %}
<section class="admin-section">
  <div class="container">
    <div class="admin-header">
      <h1>Kullanıcılar</h1>
      <div class="admin-actions">
        <form method="get" action="{{ url_for('admin.users') }}" class="flex gap-2">
          <input name="q" value="{{ q or '' }}" class="admin-input" placeholder="İsim veya e-posta ile ara" />
          <button class="btn btn-hero-modern" type="submit">Ara</button>
        </form>
      </div>
    </div>
    <div class="admin-table card">
      <table class="table-modern" id="usersTable">
        <thead>
          <tr><th></th><th>Ad</th><th>Email</th><th>Rol</th><th>Durum</th><th>İşlem</th></tr>
        </thead>
        <tbody>
          {% for u in users.items %}
          <tr>
            <td>
              {% if u.profile_photo %}
                <img src="{{ u.profile_photo }}" alt="{{ u.name }}" style="width:32px;height:32px;border-radius:999px;object-fit:cover;box-shadow:0 0 0 1px #e5e7eb;">
              {% else %}
                <div style="width:32px;height:32px;border-radius:999px;display:flex;align-items:center;justify-content:center;background:#e5e7eb;color:#64748b;">
                  <i class="fas fa-user"></i>
                </div>
              {% endif %}
            </td>
            <td>{{ u.name }}</td>
            <td>{{ u.email }}</td>
            <td>
              {% if u.is_admin %}
                <span class="badge badge-admin">Admin</span>
              {% else %}
                <span class="badge badge-user">Kullanıcı</span>
              {% endif %}
            </td>
            <td>
              {% if u.role == 'disabled' %}
                <span class="badge badge-danger">Pasif</span>
              {% else %}
                <span class="badge badge-success">Aktif</span>
              {% endif %}
            </td>
            <td class="table-actions">
              <a class="btn btn-sm btn-outline-modern" href="{{ url_for('admin.edit_user', user_id=u.id) }}">Düzenle</a>
              <form method="post" action="{{ url_for('admin.toggle_user_active', user_id=u.id) }}" style="display:inline">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                {% if u.role == 'disabled' %}
                  <button class="btn btn-sm btn-hero-modern">Aktifleştir</button>
                {% else %}
                  <button class="btn btn-sm btn-outline-modern" onclick="return confirm('Kullanıcı pasifleştirilsin mi?')">Pasifleştir</button>
                {% endif %}
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="admin-pagination">
      {% if users.has_prev %}<a class="btn btn-outline-modern" href="{{ url_for('admin.users', page=users.prev_num, q=q) }}">Önceki</a>{% else %}<span></span>{% endif %}
      {% if users.has_next %}<a class="btn btn-hero-modern" href="{{ url_for('admin.users', page=users.next_num, q=q) }}">Sonraki</a>{% endif %}
    </div>
  </div>
</section>
{% endblock %}
